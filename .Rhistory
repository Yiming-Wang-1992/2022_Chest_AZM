summarise(n=n_distinct(SequenceID)) %>% #get number of samples that have non-zero abundance bacteria as grouped by bacteria#
mutate(n.sample=nrow(df_all)) %>%
mutate(p=n/n.sample)
# Write the first data set in a new workbook, append = False, the rest of them = TRUE
write.xlsx2(df_presence, file = "Taxa prevalence and abundance", sheetName = "Prevalence",append = FALSE)
# Write the first data set in a new workbook, append = False, the rest of them = TRUE
library("xlsx")
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(
readr,
readxl,
dplyr,
data.table,
writexl,
tidyverse
)
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data_all <- read_excel("Genotyping analysis.xlsx")
pacman::p_load(
readr,
readxl,
dplyr,
data.table,
writexl,
tidyverse
)
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data_all <- read_excel("Genotyping analysis.xlsx")
View(data_all)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice")
View(data_cohort1)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`,`Mouse ID`,Sex, `Ear Notch`,Genotype)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`,`Mouse ID`,Sex, `Ear Notch`,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO")
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`,`Mouse ID`,Sex, `Ear Notch`,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
group_by(Genotype, Sex)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`,`Mouse ID`,Sex, `Ear Notch`,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
group_by(Genotype, Sex)
```{r Shape data, echo=TRUE,message=FALSE, warning=FALSE,message=FALSE, warning=FALSE}
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Genotyping Tube ID`,`Mouse ID`,Sex, `Ear Notch`,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(Genotype, Sex)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(Sex, Genotype, `Genotyping Tube ID`)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(Sex, Genotype)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(desc(Sex), desc(Genotype))
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(desc(Sex), desc(Genotype)) %>%
case_when(Sex == "m" ~ "Male",
Sex == "f" ~ "Female")
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(desc(Sex), desc(Genotype))
data_cohort1$Sex = gsub("m","Male",data_cohort1$Sex)
data_cohort1$Sex = gsub("f","Female",data_cohort1$Sex)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(desc(Genotype), desc(Sex))
data_cohort1$Sex = gsub("m","Male",data_cohort1$Sex)
data_cohort1$Sex = gsub("f","Female",data_cohort1$Sex)
data_all$Sex = gsub("m","Male",data_all$Sex)
data_all$Sex = gsub("f","Female",data_all$Sex)
data_shape<- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
arrange(desc(Genotype), desc(Sex))
View(data_shape)
data_summary <- data_shape %>%
mutate(Genotype_Sex == Genotype & "_" & Sex)
data_summary <- data_shape %>%
mutate(Genotype_Sex = Genotype & "_" & Sex)
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste0(Genotype,Sex, sep="_"))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste0(Genotype,Sex, sep="_"))
View(data_summary)
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste0(Genotype,Sex, collapse="_"))
data_all$Sex = gsub("m","Male",data_all$Sex)
data_all$Sex = gsub("f","Female",data_all$Sex)
data_shape<- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
arrange(desc(Genotype), desc(Sex))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste0(Genotype,Sex, collapse="_"))
## Shape data
```{r Shape data, echo=TRUE,message=FALSE, warning=FALSE,message=FALSE, warning=FALSE}
data_all$Sex = gsub("m","Male",data_all$Sex)
data_all$Sex = gsub("f","Female",data_all$Sex)
data_shape<- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
arrange(desc(Genotype), desc(Sex))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_"))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_"))
data_all$Sex = gsub("m","Male",data_all$Sex)
data_all$Sex = gsub("f","Female",data_all$Sex)
data_shape<- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
arrange(desc(Genotype), desc(Sex))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_"))
data_all <- data_all %>%
mutate(Sex == ifelse(Sex =="m", "Male",
ifelse (Sex == "f", "Female", "NA")))
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data_all <- read_excel("Genotyping analysis.xlsx")
data_all <- data_all %>%
mutate(Sex == ifelse(Sex =="m", "Male",
ifelse (Sex == "f", "Female", "NA")))
data_all <- data_all %>%
mutate(Sex == ifelse(Sex =="m", "Male",
ifelse (Sex == "f", "Female", "NA")))
data_all <- data_all %>%
mutate(Sex = ifelse(Sex =="m", "Male",
ifelse (Sex == "f", "Female", "NA")))
data_shape<- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
arrange(desc(Genotype), desc(Sex))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_"))
data_summary <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_")) %>%
group_by(Genotype_Sex) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 1))
data_summary_genotype <- data_shape %>%
group_by(Genotype) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 1))
View(data_summary)
View(data_summary_genotype)
data_summary_genotype <- data_shape %>%
group_by(Genotype) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 2))
data_summary_genotypesex <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_")) %>%
group_by(Genotype_Sex) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 2))
data_summary_genotype <- data_shape %>%
group_by(Genotype) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 0))
data_summary_genotype <- data_shape %>%
group_by(Genotype) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (Percentage = round (n/n_total*100, digits = 0))
data_summary_genotypesex <- data_shape %>%
mutate(Genotype_Sex = paste(Genotype,Sex, sep="_")) %>%
group_by(Genotype_Sex) %>%
summarise(n = n_distinct(`Mouse ID`)) %>%
mutate(n_total=nrow(data_shape)) %>%
mutate (p = round (n/n_total*100, digits = 0))
data_summary_genotype %>%
kbl(caption = "Summary of samples' genotype") %>%
kable_classic(full_width = F, html_font ="Cambria")
pacman::p_load(
readr,
readxl,
dplyr,
data.table,
writexl,
tidyverse,
kableExtra
)
data_summary_genotype %>%
kbl(caption = "Summary of samples' genotype") %>%
kable_classic(full_width = F, html_font ="Cambria")
data_summary_genotypesex %>%
kbl(caption = "Summary of samples' genotype and sex") %>%
kable_classic(full_width = F, html_font ="Cambria")
data_summary_genotype %>%
kbl(caption = "Summary of genotype") %>%
kable_classic(full_width = F, html_font ="Cambria")
data_summary_genotypesex %>%
kbl(caption = "Summary of genotype and sex") %>%
kable_classic(full_width = F, html_font ="Cambria")
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex,Genotype) %>%
filter(Genotype == "WT"|Genotype == "KO") %>%
arrange(desc(Genotype), desc(Sex))
pacman::p_load(
readr,
readxl,
dplyr,
data.table,
writexl,
tidyverse,
kableExtra,
openxlsx
)
View(data_cohort1)
data_cohort1 <- data_all %>%
filter(Rationale == "Keep WT and KO for experimental mice") %>%
select(`Mouse ID`, `Ear Notch`, `Genotyping Tube ID`,Sex, Genotype)
View(data_cohort1)
pacman::p_load(
dplyr,
tidyverse,
readxl,
kableExtra)
setwd("D:/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Windows
# setwd("/Volumes/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Mac
df_all <- read_excel("example.xlsx")
pacman::p_load(
dplyr,
tidyverse,
readxl,
kableExtra)
setwd("D:/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Windows
# setwd("/Volumes/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Mac
df_all <- read_excel("example.xlsx")
pacman::p_load(
dplyr,
tidyverse,
readxl,
kableExtra)
setwd("D:/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Windows
df_all <- read_excel("example.xlsx")
pacman::p_load(
dplyr,
tidyverse,
readxl,
kableExtra)
setwd("D:/My backup disk/Things currently working on/AZM+SERPAT/Submission_Chest_2021") # Windows
df_all <- read_excel("example.xlsx")
df_all <- read_excel("example.xlsx")
Age <- df_all %>%
group_by(Group) %>%
summarise(count=sum(!is.na(Age)),mean =mean(Age,na.rm=T))
View(Age)
Sex <- df_all %>%
group_by(Group) %>%
summarise(n=n()) %>%
mutate(percentage=n/sum(n))
View(Sex)
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(
readxl,
dplyr,
tidyverse,
openxlsx
)
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/cohort 3") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data <- read_excel("Experimental mice manifest_template.xlsx",
sheet = "Working sheet_Cohort 3", col_types = c("numeric",
"numeric", "text", "text", "numeric", "text",
"numeric", "text", "text", "text",
"text", "numeric", "date", "date",
"numeric", "text", "text", "text",
"date", "text", "numeric", "numeric",
"text", "numeric", "text", "text",
"text", "numeric", "numeric", "numeric",
"text", "text", "text", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "text", "numeric",
"text", "text"), skip = 4) # Skip = 4 indicate read from row 5; skip = XX always skip row, if skip column, then c("skip","A")
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/cohort 3") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data <- read_excel("Experimental mice manifest_before cohort3.xlsx",
sheet = "Working sheet_Cohort 3", col_types = c("numeric",
"numeric", "text", "text", "numeric", "text",
"numeric", "text", "text", "text",
"text", "numeric", "date", "date",
"numeric", "text", "text", "text",
"date", "text", "numeric", "numeric",
"text", "numeric", "text", "text",
"text", "numeric", "numeric", "numeric",
"text", "text", "text", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "text", "numeric",
"text", "text"), skip = 4) # Skip = 4 indicate read from row 5; skip = XX always skip row, if skip column, then c("skip","A")
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest") #Mac
data <- read_excel("Experimental mice manifest_before cohort3.xlsx",
sheet = "Working sheet_Cohort 3", col_types = c("numeric",
"numeric", "text", "text", "numeric", "text",
"numeric", "text", "text", "text",
"text", "numeric", "date", "date",
"numeric", "text", "text", "text",
"date", "text", "numeric", "numeric",
"text", "numeric", "text", "text",
"text", "numeric", "numeric", "numeric",
"text", "text", "text", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "text", "numeric",
"text", "text"), skip = 4) # Skip = 4 indicate read from row 5; skip = XX always skip row, if skip column, then c("skip","A")
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3") #Mac
data <- read_excel("Experimental mice manifest_before cohort 3.xlsx",
sheet = "Working sheet_Cohort 3", col_types = c("numeric",
"numeric", "text", "text", "numeric", "text",
"numeric", "text", "text", "text",
"text", "numeric", "date", "date",
"numeric", "text", "text", "text",
"date", "text", "numeric", "numeric",
"text", "numeric", "text", "text",
"text", "numeric", "numeric", "numeric",
"text", "text", "text", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "text", "numeric",
"text", "text"), skip = 4) # Skip = 4 indicate read from row 5; skip = XX always skip row, if skip column, then c("skip","A")
setwd("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3") #Windows
# setwd("/Volumes/Yiming Wang/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3") #Mac
data <- read_excel("Experimental mice manifest_before cohort 3.xlsx",
sheet = "Working sheet_Cohort 3", col_types = c("numeric",
"numeric", "text", "text", "numeric", "text",
"numeric", "text", "text", "text",
"text", "numeric", "date", "date",
"numeric", "text", "text", "text",
"date", "text", "numeric", "numeric",
"text", "numeric", "text", "text",
"text", "numeric", "numeric", "numeric",
"text", "text", "text", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "text", "numeric",
"text", "text"), skip = 4) # Skip = 4 indicate read from row 5; skip = XX always skip row, if skip column, then c("skip","A")
View(data)
View(data)
Seq<-data.frame(seq=seq(1,100,by=1), # first column
collection_date=seq(as.Date("2022-01-22",format="%Y-%m-%d"),by="day",length.out = 100), # second column
day_id=paste0("D",seq(0,99,by=1))) # third column
View(Seq)
day_1<-c(seq(0,27,by=1),34,41,48,55,97)
day_1<-paste0("D",day_1)
View(data)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100))
View(data.clean)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq")
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date))
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date)) %>% # Date in numberic + 8 days
mutate(collection_date=as.Date(as.POSIXct.Date(collection_date),format="%Y-%m-%d"))
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date)) %>% # Date in numberic + 8 days
mutate(collection_date=as.Date(as.POSIXct.Date(collection_date),format="%Y-%m-%d")) %>% # convert it back to date
mutate(collection_tube_id=gsub("D","",paste0("C",day_id,"T",Sample_ID)))
View(data.clean)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date)) %>% # Date in numberic + 8 days
mutate(collection_date=as.Date(as.POSIXct.Date(collection_date),format="%Y-%m-%d")) %>% # convert it back to date
mutate(collection_tube_id=gsub("D","",paste0("C",day_id,"T",Sample_ID)))%>%
mutate(Collection_Date...14=collection_date, # substitute the whole column "Collection_Date...14" by using "collection_date", only change the column content
Collection_Date...19=collection_date,
Day_ID=day_id,
Collection_tube_ID=collection_tube_id)%>%
mutate(DOB=as.Date(DOB,format="%Y-%m-%d"))
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date)) %>% # Date in numberic + 8 days
mutate(collection_date=as.Date(as.POSIXct.Date(collection_date),format="%Y-%m-%d")) %>% # convert it back to date
mutate(collection_tube_id=gsub("D","",paste0("C",day_id,"T",Sample_ID)))%>%
mutate(Collection_Date...14=collection_date, # substitute the whole column "Collection_Date...14" by using "collection_date", only change the column content
Collection_Date...19=collection_date,
Day_ID=day_id,
Collection_tube_ID=collection_tube_id)%>%
mutate(DOB=as.Date(DOB,format="%Y-%m-%d")) %>%
mutate(Age_week=round(difftime(Collection_Date...14,DOB,units = "weeks"),1))
day_1<-c(seq(0,19,by=1),26,47,89)
day_1<-paste0("D",day_1)
day_2<-c(seq(0,27,by=1),34,41,48,55,97)
day_2<-paste0("D",day_2)
data.clean<-data %>%
filter(Sample_ID<=8)%>%
filter(Mouse_ID!="31.4F")%>%
slice(rep(1:n(),100)) %>% #subset rows using their position, repeat 1 to last row for 100 times (select these rows and repeat these rows, select is used to select column, slice is used for selecting row)
mutate(rn=row_number())%>%
group_by(Mouse_ID) %>%
mutate(seq=row_number())%>% # create a column to reveal the loop number based on mouse ID
left_join(Seq,by="seq") %>% # left_join(x,y) means include all rows in x, x is data.clean, y is Seq, Y join to x
mutate(collection_date=ifelse(Treatment_ID=="PRO" & seq>1,collection_date+8,collection_date)) %>% # Date in numberic + 8 days
mutate(collection_date=as.Date(as.POSIXct.Date(collection_date),format="%Y-%m-%d")) %>% # convert it back to date
mutate(collection_tube_id=gsub("D","",paste0("C",day_id,"T",Sample_ID)))%>%
mutate(Collection_Date...14=collection_date, # substitute the whole column "Collection_Date...14" by using "collection_date", only change the column content
Collection_Date...19=collection_date,
Day_ID=day_id,
Collection_tube_ID=collection_tube_id)%>%
mutate(DOB=as.Date(DOB,format="%Y-%m-%d")) %>%
mutate(Age_week=round(difftime(Collection_Date...14,DOB,units = "weeks"),1))%>%
filter(if(Treatment_ID=="PRO") Day_ID %in% day_1 else Day_ID %in% day_2) %>%
select(-rn,-seq,-collection_date,-day_id,-collection_tube_id)
library(openxlsx)
wb <- loadWorkbook("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Experimental mice manifest_before cohort 3.xlsx")
writeData(wb, data.clean, sheet = "Working sheet_Cohort 3", rowNames = FALSE, colNames = FALSE, startRow = 7)
library(openxlsx)
wb <- loadWorkbook("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Experimental mice manifest_before cohort 3.xlsx")
library(openxlsx)
wb <- loadWorkbook("D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Cohort 3/Experimental mice manifest_before cohort 3.xlsx")
writeData(wb, data.clean, sheet = "Working sheet_Cohort 3", rowNames = FALSE, colNames = FALSE, startRow = 7)
saveWorkbook(wb, "D:/My backup disk/Things currently working on/FUT2/Second mouse model/Collection manifest/Experimental mice manifest_before cohort 3.xlsx", overwrite = TRUE)
View(data.clean)
